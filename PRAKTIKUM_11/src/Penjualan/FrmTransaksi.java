/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JFrame.java to edit this template
 */
package Penjualan;

import java.awt.print.PrinterException;
import java.sql.*;
import java.text.MessageFormat;
import java.util.Calendar;
import javax.swing.JComboBox;
import javax.swing.JOptionPane;
import javax.swing.JSpinner;
import javax.swing.SwingWorker;
import javax.swing.table.DefaultTableModel;
/**
 *
 * @author Acer
 */
public class FrmTransaksi extends javax.swing.JFrame {
    Connection conn;
    ResultSet RsBrg, RsKons;
    Statement stm;
    double total = 0;
    String tanggal;
    Boolean edit = false;
    String idBrg;
    String namaBrg;
    String hargaBrg;
    
    DefaultTableModel tableModel = new DefaultTableModel(
            new Object[][] {},
            new String[] {
                "Kode Barang", "Nama Barang", "Harga", "Jumlah", "Total"
            }
    );
    
    /**
     * Creates new form FrmTransaksi
     */
    public FrmTransaksi() {
        initComponents();
        open_db();
        inisialisasi_tabel();
        aktif(false);
        setTombol(true);
        txtTgl.setEditor(new JSpinner.DateEditor(txtTgl,"yyyy/MM/dd"));
        dataKonsumen();
        dataBarang();
        nomorJual();
        resetData();
        resetDetailBarang();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jLabel1 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        noJual = new javax.swing.JTextField();
        jLabel3 = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        cmbKodeKonsumen = new javax.swing.JComboBox<>();
        namaKonsumen = new javax.swing.JTextField();
        cmbKodeBarang = new javax.swing.JComboBox<>();
        btnHapusItem = new javax.swing.JButton();
        fieldNamaBarang = new javax.swing.JTextField();
        fieldHargaBarang = new javax.swing.JTextField();
        fieldJumlah = new javax.swing.JTextField();
        fieldTotalBarang = new javax.swing.JTextField();
        jScrollPane1 = new javax.swing.JScrollPane();
        tblBarang = new javax.swing.JTable();
        btnPilihBarang = new javax.swing.JButton();
        fieldKodeBarang = new javax.swing.JTextField();
        jLabel5 = new javax.swing.JLabel();
        jLabel6 = new javax.swing.JLabel();
        jLabel7 = new javax.swing.JLabel();
        fieldTotal = new javax.swing.JTextField();
        fieldBayar = new javax.swing.JTextField();
        fieldKembalian = new javax.swing.JTextField();
        btnTambah = new javax.swing.JButton();
        btnSimpan = new javax.swing.JButton();
        btnBatal = new javax.swing.JButton();
        btnCetak = new javax.swing.JButton();
        btnKeluar = new javax.swing.JButton();
        dateChooser = new com.toedter.calendar.JDateChooser();
        cmbDate = new datechooser.beans.DateChooserCombo();
        jScrollPane2 = new javax.swing.JScrollPane();
        text = new javax.swing.JTextArea();
        txtTgl = new javax.swing.JSpinner();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);

        jLabel1.setText("No. Jual");

        jLabel2.setText("Tgl. Jual");

        jLabel3.setText("Kode Konsumen");

        jLabel4.setText("Nama Konsumen");

        cmbKodeKonsumen.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "-- Pilih --" }));
        cmbKodeKonsumen.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmbKodeKonsumenActionPerformed(evt);
            }
        });

        namaKonsumen.setBackground(new java.awt.Color(0, 153, 153));

        cmbKodeBarang.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "-- Pilih --" }));
        cmbKodeBarang.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmbKodeBarangActionPerformed(evt);
            }
        });

        btnHapusItem.setText("Hapus Item");
        btnHapusItem.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnHapusItemActionPerformed(evt);
            }
        });

        fieldNamaBarang.setEditable(false);
        fieldNamaBarang.setBackground(new java.awt.Color(0, 153, 153));

        fieldHargaBarang.setEditable(false);
        fieldHargaBarang.setBackground(new java.awt.Color(0, 153, 153));

        fieldJumlah.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                fieldJumlahFocusLost(evt);
            }
        });
        fieldJumlah.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                fieldJumlahActionPerformed(evt);
            }
        });

        fieldTotalBarang.setEditable(false);
        fieldTotalBarang.setBackground(new java.awt.Color(0, 153, 153));
        fieldTotalBarang.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                fieldTotalBarangActionPerformed(evt);
            }
        });

        tblBarang.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null, null},
                {null, null, null, null, null},
                {null, null, null, null, null},
                {null, null, null, null, null}
            },
            new String [] {
                "Kode Barang", "Nama Barang", "Harga", "Jumlah", "Total"
            }
        ) {
            Class[] types = new Class [] {
                java.lang.String.class, java.lang.String.class, java.lang.Double.class, java.lang.Integer.class, java.lang.Double.class
            };
            boolean[] canEdit = new boolean [] {
                false, false, false, false, false
            };

            public Class getColumnClass(int columnIndex) {
                return types [columnIndex];
            }

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        jScrollPane1.setViewportView(tblBarang);

        btnPilihBarang.setText("Pilih Barang");
        btnPilihBarang.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnPilihBarangActionPerformed(evt);
            }
        });

        fieldKodeBarang.setEditable(false);
        fieldKodeBarang.setBackground(new java.awt.Color(0, 153, 153));

        jLabel5.setText("Total");

        jLabel6.setText("Bayar");

        jLabel7.setText("Kembali");

        fieldTotal.setEditable(false);
        fieldTotal.setBackground(new java.awt.Color(0, 153, 153));

        fieldBayar.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                fieldBayarFocusLost(evt);
            }
        });
        fieldBayar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                fieldBayarActionPerformed(evt);
            }
        });

        fieldKembalian.setEditable(false);
        fieldKembalian.setBackground(new java.awt.Color(0, 153, 153));

        btnTambah.setText("TAMBAH");
        btnTambah.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnTambahActionPerformed(evt);
            }
        });

        btnSimpan.setText("SIMPAN");
        btnSimpan.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnSimpanActionPerformed(evt);
            }
        });

        btnBatal.setText("BATAL");
        btnBatal.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnBatalActionPerformed(evt);
            }
        });

        btnCetak.setText("CETAK");
        btnCetak.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnCetakActionPerformed(evt);
            }
        });

        btnKeluar.setText("KELUAR");
        btnKeluar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnKeluarActionPerformed(evt);
            }
        });

        dateChooser.setDateFormatString("dd-MM-yyyy");

        text.setColumns(20);
        text.setRows(5);
        jScrollPane2.setViewportView(text);

        txtTgl.setModel(new javax.swing.SpinnerDateModel());

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGap(24, 24, 24)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(btnHapusItem, javax.swing.GroupLayout.PREFERRED_SIZE, 95, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(18, 18, 18)
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addGroup(layout.createSequentialGroup()
                                        .addComponent(fieldNamaBarang, javax.swing.GroupLayout.PREFERRED_SIZE, 180, javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                        .addComponent(fieldHargaBarang, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                        .addComponent(fieldJumlah, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                        .addComponent(fieldTotalBarang, javax.swing.GroupLayout.PREFERRED_SIZE, 158, javax.swing.GroupLayout.PREFERRED_SIZE))
                                    .addGroup(layout.createSequentialGroup()
                                        .addComponent(btnPilihBarang, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                        .addComponent(fieldKodeBarang, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE))))
                            .addGroup(layout.createSequentialGroup()
                                .addGap(309, 309, 309)
                                .addComponent(btnTambah)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(btnSimpan)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addGroup(layout.createSequentialGroup()
                                        .addComponent(btnBatal)
                                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                        .addComponent(btnCetak)
                                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                        .addComponent(btnKeluar))
                                    .addGroup(layout.createSequentialGroup()
                                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                            .addComponent(jLabel7)
                                            .addComponent(jLabel6)
                                            .addComponent(jLabel5))
                                        .addGap(18, 18, 18)
                                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                            .addComponent(fieldTotal, javax.swing.GroupLayout.PREFERRED_SIZE, 192, javax.swing.GroupLayout.PREFERRED_SIZE)
                                            .addComponent(fieldBayar, javax.swing.GroupLayout.PREFERRED_SIZE, 195, javax.swing.GroupLayout.PREFERRED_SIZE)
                                            .addComponent(fieldKembalian, javax.swing.GroupLayout.PREFERRED_SIZE, 196, javax.swing.GroupLayout.PREFERRED_SIZE))))))
                        .addContainerGap())
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel1)
                            .addComponent(jLabel2)
                            .addComponent(cmbKodeBarang, javax.swing.GroupLayout.PREFERRED_SIZE, 95, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(txtTgl, javax.swing.GroupLayout.PREFERRED_SIZE, 95, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(271, 271, 271)
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(jLabel4)
                                    .addComponent(jLabel3))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(cmbKodeKonsumen, javax.swing.GroupLayout.PREFERRED_SIZE, 95, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(namaKonsumen, javax.swing.GroupLayout.PREFERRED_SIZE, 175, javax.swing.GroupLayout.PREFERRED_SIZE))
                                .addGap(0, 0, Short.MAX_VALUE))
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(noJual, javax.swing.GroupLayout.PREFERRED_SIZE, 95, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(18, 18, 18)
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                                    .addComponent(dateChooser, javax.swing.GroupLayout.PREFERRED_SIZE, 145, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(cmbDate, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.PREFERRED_SIZE, 145, javax.swing.GroupLayout.PREFERRED_SIZE))
                                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))))
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, 440, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 770, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(0, 28, Short.MAX_VALUE))))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(17, 17, 17)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(dateChooser, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                .addComponent(jLabel1)
                                .addComponent(noJual, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))))
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(cmbKodeKonsumen, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(jLabel3)))
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(namaKonsumen, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jLabel4)
                            .addComponent(jLabel2))
                        .addComponent(cmbDate, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(txtTgl, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(32, 32, 32)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(cmbKodeBarang, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(fieldNamaBarang, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(fieldHargaBarang, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(fieldJumlah, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(fieldTotalBarang, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(btnHapusItem)
                    .addComponent(btnPilihBarang)
                    .addComponent(fieldKodeBarang, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 186, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(12, 12, 12)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jLabel5)
                            .addComponent(fieldTotal, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(18, 18, 18)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jLabel6)
                            .addComponent(fieldBayar, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(18, 18, 18)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jLabel7)
                            .addComponent(fieldKembalian, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
                    .addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, 187, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(btnTambah)
                    .addComponent(btnSimpan)
                    .addComponent(btnBatal)
                    .addComponent(btnCetak)
                    .addComponent(btnKeluar))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        pack();
        setLocationRelativeTo(null);
    }// </editor-fold>//GEN-END:initComponents
    
    // Method Koneksi Database
    private void open_db(){
        try{
            KoneksiMysql koneksi = new KoneksiMysql("localhost", "root", "", "penjualan");
            conn = koneksi.getConnection();
        } catch (Exception e){
            System.out.println("Error : "+e);
        }
    }
    // Method Hitung Penjualan
    private void hitung_jual(){
        double xTot, xHrg;
        int xJml;
        xHrg = Double.parseDouble(fieldHargaBarang.getText());
        xJml = Integer.parseInt(fieldJumlah.getText());
        xTot = xHrg * xJml;
        String xTotal = Double.toString(xTot);
        fieldTotalBarang.setText(xTotal);
        total += xTot;
        fieldTotal.setText(Double.toString(total));
    }
    // Method Read Data Konsumen
    private void dataKonsumen(){
        try{
            stm = conn.createStatement(ResultSet.TYPE_SCROLL_SENSITIVE, ResultSet.CONCUR_READ_ONLY);
            String readKonsumen = "Select kd_kons, nm_kons from konsumen";
            RsKons = stm.executeQuery(readKonsumen);
            RsKons.beforeFirst();
            while(RsKons.next()){
                cmbKodeKonsumen.addItem(RsKons.getString(1).trim());
            }
            RsKons.close();
        } catch(SQLException e){
            JOptionPane.showMessageDialog(null, e);
        }
    }
    // Method Read Data Barang
    private void dataBarang(){
        try{
            stm = conn.createStatement(ResultSet.TYPE_SCROLL_SENSITIVE, ResultSet.CONCUR_READ_ONLY);
            String readBarang = "Select * from barang";
            RsBrg = stm.executeQuery(readBarang);
            RsBrg.beforeFirst();
            while(RsBrg.next()){
                cmbKodeBarang.addItem(RsBrg.getString(1).trim());
            }
            RsBrg.close();
        } catch(SQLException e){
            JOptionPane.showMessageDialog(null, e);
        }
    }
    // Method Read Data Barang -> Combo Barang Di Klik
    private void detailBarang(String xKode){
        try{
            stm = conn.createStatement(ResultSet.TYPE_SCROLL_SENSITIVE, ResultSet.CONCUR_READ_ONLY);
            String readDetailBarang = "Select * from barang where kd_brg = '"+xKode+"'";
            RsBrg = stm.executeQuery(readDetailBarang);
            RsBrg.beforeFirst();
            while(RsBrg.next()){
                fieldNamaBarang.setText(RsBrg.getString(2).trim());
                fieldHargaBarang.setText(Double.toString((Double) RsBrg.getDouble(4)));
            }
            RsBrg.close();
        } catch(SQLException e){
            JOptionPane.showMessageDialog(null, e);
        }
    }
    // Method Read Data Konsumen -> Combo Barang Di Klik
    private void detailKonsumen(String xKode){
        try{
            stm = conn.createStatement(ResultSet.TYPE_SCROLL_SENSITIVE, ResultSet.CONCUR_READ_ONLY);
            String readDetailKonsumen = "Select * from konsumen where kd_kons = '"+xKode+"'";
            RsKons = stm.executeQuery(readDetailKonsumen);
            RsKons.beforeFirst();
            while(RsKons.next()){
                namaKonsumen.setText(RsKons.getString(2).trim());
            }
            RsKons.close();
        } catch(SQLException e){
            JOptionPane.showMessageDialog(null, e);
        }
    }
    // Set Model Table
    public void inisialisasi_tabel(){
        tblBarang.setModel(tableModel);
    }
    // Reset Data
    private void resetData(){
        noJual.setText("");
        namaKonsumen.setText("");
        fieldHargaBarang.setText("");
        fieldTotal.setText("");
    }
    // Reset Detail Barang
    private void resetDetailBarang(){
        fieldNamaBarang.setText("");
        fieldHargaBarang.setText("");
        fieldJumlah.setText("");
        fieldTotalBarang.setText("");
        fieldKodeBarang.setText("");
        fieldTotal.setText("");
    }
    // Enabled/Disabled Field Text
    private void aktif(boolean x){
        noJual.setEnabled(x);
        dateChooser.setEnabled(x);
        cmbDate.setEnabled(x);
        cmbKodeKonsumen.setEnabled(x);
        cmbKodeBarang.setEnabled(x);
        txtTgl.setEnabled(x);
        fieldJumlah.setEditable(x);
        fieldBayar.setEnabled(x);
    }
    // Enabled/Disabled Button
    private void setTombol(boolean t){
        btnTambah.setEnabled(t);
        btnSimpan.setEnabled(!t);
        btnBatal.setEnabled(!t);
        btnKeluar.setEnabled(t);
        btnHapusItem.setEnabled(!t);
    }
    // Create Number Sale Otomation
    private void nomorJual(){
        try{
            stm = conn.createStatement(ResultSet.TYPE_SCROLL_SENSITIVE, ResultSet.CONCUR_READ_ONLY);
            String query = "Select no_jual from jual";
            ResultSet RsNumber = stm.executeQuery(query);
            int row = 0;
            while(RsNumber.next()){
                row = RsNumber.getRow();
            }
            if(row == 0){
                noJual.setText("1");
            } else {
                row += 1;
                noJual.setText(Integer.toString(row));
            }
            RsNumber.close();
        } catch(SQLException e){
            JOptionPane.showMessageDialog(null, e);
        }
    }
    // Simpan detail jual di table
    private void saveAtTable(){
        try{
            String columnKode = cmbKodeBarang.getSelectedItem().toString();
            String columnNama = fieldNamaBarang.getText();
            double columnHarga = Double.parseDouble(fieldHargaBarang.getText());
            int columnJumlah = Integer.parseInt(fieldJumlah.getText());
            double columnTotal = Double.parseDouble(fieldTotalBarang.getText());
            tableModel.addRow(new Object[]{
                columnKode,
                columnNama,
                columnHarga,
                columnJumlah,
                columnTotal
            });
            inisialisasi_tabel();
        } catch(Exception e){
            System.out.println("Error : "+e);
        }
    }
    // Simpan transaksi penjualan pada table di MySQL
    private void saveTransaction(){
        try{
            String x_noJual = noJual.getText();
            String x_kodeKonsumen = cmbKodeKonsumen.getSelectedItem().toString();
            // Function Format Tanggal
            formatDate();
            String query = "INSERT INTO jual VALUES ('"+x_noJual+"', '"+x_kodeKonsumen+"', '"+tanggal+"')";
            stm.executeUpdate(query);
            
            for(int i = 0; i < tblBarang.getRowCount(); i++){
                String kodeBarang = (String) tblBarang.getValueAt(i, 0);
                double harga = (Double) tblBarang.getValueAt(i, 2);
                int jumlah = (Integer) tblBarang.getValueAt(i, 3);
                String addTransaksi = "INSERT INTO djual VALUES ('"+x_noJual+"', '"+kodeBarang+"', '"+harga+"', '"+jumlah+"')";
                stm.executeUpdate(addTransaksi);
            }
        } catch(SQLException e){
            JOptionPane.showMessageDialog(null, e);
        }
    }
    // Membuat Format Tanggal sesuai dengan MySQL
    private void formatDate(){
        String DATE_FORMAT = "yyyy-MM-dd";
        java.text.SimpleDateFormat dateFormat = new java.text.SimpleDateFormat(DATE_FORMAT);
        Calendar calendar = Calendar.getInstance();
        int year = calendar.get(Calendar.YEAR);
        int month = calendar.get(Calendar.MONTH) + 1;
        int day = calendar.get(Calendar.DAY_OF_MONTH);
        tanggal = Integer.toString(year) +"-"+ Integer.toString(month) +"-"+ Integer.toString(day);
    }
    
    private class PrintingTask extends SwingWorker<Object, Object>{
        private final MessageFormat headerFormat;
        private final MessageFormat footerFormat;
        private final boolean interactive;
        private volatile boolean complete = false;
        private volatile String message;
        
        public PrintingTask(MessageFormat header, MessageFormat footer, boolean interactive){
            this.headerFormat = header;
            this.footerFormat = footer;
            this.interactive = interactive;
        }
        
        @Override
        protected Object doInBackground(){
            try{
                complete = text.print(headerFormat, footerFormat, true, null, null, interactive);
                message = "Printing "+(complete ? "complete" : "canceled");
            } catch(PrinterException ex){
                message = "Sorry, a printer error occured";
            } catch(SecurityException ex){
                message = "Sorry, cannot access the printer due to security reasons";
            }
            return null;
        }
        
        @Override
        protected void done(){
            
        }
    }
    
    private void fieldTotalBarangActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_fieldTotalBarangActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_fieldTotalBarangActionPerformed

    private void cmbKodeKonsumenActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmbKodeKonsumenActionPerformed
        JComboBox cSatuan = (javax.swing.JComboBox)evt.getSource();
        //Membaca Item Yang Terpilih — > String
        String sSatuan = (String)cSatuan.getSelectedItem();
        detailKonsumen(sSatuan);
    }//GEN-LAST:event_cmbKodeKonsumenActionPerformed

    private void btnCetakActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnCetakActionPerformed
        // TODO add your handling code here:
        String cetak = "Nota Penjualan\nNo : "+noJual.getText()+"\nTanggal : "+tanggal+"\n"+"-------------------------------------------------------------------------------------------------\n"+"Kode\tNama Barang\tHarga\tJumlah\tTotal\n"+"-------------------------------------------------------------------------------------------------"; 
        for(int i = 0; i < tblBarang.getRowCount(); i++){
            String kodeBarang = (String)tblBarang.getValueAt(i, 0);
            String namaBarang = (String)tblBarang.getValueAt(i, 1);
            double harga = (Double)tblBarang.getValueAt(i, 2);
            int jumlah = (Integer)tblBarang.getValueAt(i, 3);
            double total = (Double)tblBarang.getValueAt(i, 4);
            cetak += "\n"+kodeBarang+"\t"+namaBarang+"\t"+harga+"\t"+jumlah+"\t"+total;
        }
        cetak += "\n"+"-------------------------------------------------------------------------------------------------";
        text.setText(cetak);
        String headerField = "";
        String footerField = "";
        MessageFormat header = new MessageFormat(headerField);
        MessageFormat footer = new MessageFormat(footerField);
        boolean interactive = true;
        boolean background = true;
        PrintingTask task = new PrintingTask(header, footer, interactive);
        if(background){
            task.execute();
        } else {
            task.run();
        }
    }//GEN-LAST:event_btnCetakActionPerformed

    private void btnPilihBarangActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnPilihBarangActionPerformed
        FrmSelectBarang fDB = new FrmSelectBarang();
        fDB.fAB = this;
        fDB.setVisible(true);
        fDB.setResizable(false);
    }//GEN-LAST:event_btnPilihBarangActionPerformed

    private void btnKeluarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnKeluarActionPerformed
        this.dispose();
    }//GEN-LAST:event_btnKeluarActionPerformed

    private void btnBatalActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnBatalActionPerformed
        aktif(false);
        setTombol(true);
        resetData();
        resetDetailBarang();
        nomorJual();
    }//GEN-LAST:event_btnBatalActionPerformed

    private void btnSimpanActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnSimpanActionPerformed
        saveAtTable();
        saveTransaction();
    }//GEN-LAST:event_btnSimpanActionPerformed

    private void btnTambahActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnTambahActionPerformed
        aktif(true);
        setTombol(false);
        resetData();
        nomorJual();
    }//GEN-LAST:event_btnTambahActionPerformed

    private void fieldJumlahActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_fieldJumlahActionPerformed
        hitung_jual();
    }//GEN-LAST:event_fieldJumlahActionPerformed

    private void cmbKodeBarangActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmbKodeBarangActionPerformed
        JComboBox cSatuan = (javax.swing.JComboBox)evt.getSource();
        //Membaca Item Yang Terpilih — > String
        String sSatuan = (String)cSatuan.getSelectedItem();
        detailBarang(sSatuan);
    }//GEN-LAST:event_cmbKodeBarangActionPerformed

    private void fieldBayarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_fieldBayarActionPerformed
        float bayar = Float.valueOf(fieldBayar.getText());
        float total = Float.valueOf(fieldTotal.getText());
        float kembalian = bayar - total;
        fieldKembalian.setText(Float.toString(kembalian));
    }//GEN-LAST:event_fieldBayarActionPerformed

    private void fieldJumlahFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_fieldJumlahFocusLost
        // TODO add your handling code here:
//        hitung_jual();
    }//GEN-LAST:event_fieldJumlahFocusLost

    private void fieldBayarFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_fieldBayarFocusLost
        // TODO add your handling code here:
        double a = Double.parseDouble(fieldTotal.getText());
        double b = Double.parseDouble(fieldBayar.getText());
        double hasil = b-a;
        String xtotal = Double.toString(hasil);
        fieldKembalian.setText(xtotal);
    }//GEN-LAST:event_fieldBayarFocusLost

    private void btnHapusItemActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnHapusItemActionPerformed
        // TODO add your handling code here:
        resetDetailBarang();
    }//GEN-LAST:event_btnHapusItemActionPerformed
    
    public void itemTerpilih(){
        FrmSelectBarang fDB = new FrmSelectBarang();
        fDB.fAB = this;
        fieldKodeBarang.setText(idBrg);
        fieldNamaBarang.setText(namaBrg);
        fieldHargaBarang.setText(hargaBrg);
    }
    
    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(FrmTransaksi.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(FrmTransaksi.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(FrmTransaksi.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(FrmTransaksi.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new FrmTransaksi().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnBatal;
    private javax.swing.JButton btnCetak;
    private javax.swing.JButton btnHapusItem;
    private javax.swing.JButton btnKeluar;
    private javax.swing.JButton btnPilihBarang;
    private javax.swing.JButton btnSimpan;
    private javax.swing.JButton btnTambah;
    private datechooser.beans.DateChooserCombo cmbDate;
    private javax.swing.JComboBox<String> cmbKodeBarang;
    private javax.swing.JComboBox<String> cmbKodeKonsumen;
    private com.toedter.calendar.JDateChooser dateChooser;
    private javax.swing.JTextField fieldBayar;
    private javax.swing.JTextField fieldHargaBarang;
    private javax.swing.JTextField fieldJumlah;
    private javax.swing.JTextField fieldKembalian;
    private javax.swing.JTextField fieldKodeBarang;
    private javax.swing.JTextField fieldNamaBarang;
    private javax.swing.JTextField fieldTotal;
    private javax.swing.JTextField fieldTotalBarang;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JTextField namaKonsumen;
    private javax.swing.JTextField noJual;
    private javax.swing.JTable tblBarang;
    private javax.swing.JTextArea text;
    private javax.swing.JSpinner txtTgl;
    // End of variables declaration//GEN-END:variables
}